<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SCI Cupping Form (Interactive)</title>
  <style>
    :root{
      --ink:#1a1a1a;
      --line:#2a2a2a;
      --bg:#fff;
      --font: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    *{box-sizing:border-box}
    body{margin:0;background:#f2f2f2;color:var(--ink);font-family:var(--font)}
    .page{
      width:min(1400px, 98vw);
      margin:12px auto;
      background:var(--bg);
      border:1px solid #ccc;
      box-shadow:0 6px 24px rgba(0,0,0,.08);
      padding:14px;
    }
    .toolbar{
      display:flex;gap:8px;flex-wrap:wrap;align-items:center;
      padding:8px 10px;margin-bottom:10px;
      border:1px solid #ddd;border-radius:12px;background:#fafafa;
    }
    .toolbar button{font:inherit}
    .toolbar button{
      padding:8px 10px;border:1px solid #ccc;border-radius:10px;background:#fff;cursor:pointer;
    }
    .toolbar button:hover{border-color:#888}
    .toolbar .spacer{flex:1}

    .header{
      display:flex;align-items:flex-start;justify-content:space-between;gap:12px;
      border-bottom:2px solid var(--line);
      padding-bottom:8px;margin-bottom:10px;
    }
    .header-left{display:flex;flex-direction:column;gap:6px;font-size:14px}
    .linefield{display:flex;gap:8px;align-items:center}
    .linefield label{min-width:54px;font-weight:600}
    .linefield input{
      border:0;border-bottom:1px solid var(--ink);
      padding:2px 4px;min-width:260px;outline:none;font-size:14px;
    }
    .brand{text-align:right;font-size:12px;color:#333;line-height:1.2}
    .brand b{letter-spacing:.3px}

    /* SCREEN grid is flexible */
    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
      gap:10px;
    }

    .sample{
      border:2px solid var(--line);
      padding:0;
      min-height:860px;
      display:flex;flex-direction:column;
      background:#fff;
    }
    .sample .toprow{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      padding:10px 10px 8px 10px;
      border-bottom:2px solid var(--line);
    }
    .sample .toprow .sampleNo{
      font-weight:700;font-size:13px;
      display:flex;flex-direction:column;gap:6px;
    }
    .sample .toprow input{
      border:0;border-bottom:1px solid var(--ink);
      outline:none;font-size:13px;padding:2px 4px;width:100%;
    }
    .scorebox{
      width:130px;border:2px solid var(--line);
      padding:8px;border-radius:8px;
      display:flex;flex-direction:column;gap:6px;align-items:stretch;background:#fff;
    }
    .scorebox .lbl{font-size:11px;color:#333;font-weight:700;text-align:center}
    .scorebox .total{
      font-size:22px;font-weight:800;text-align:center;
      border-top:1px solid #999;padding-top:6px;
    }
    .scorebox .subtot{
      font-size:11px;color:#222;font-weight:700;line-height:1.25;
      border-top:1px dashed #aaa;padding-top:6px;margin-top:2px;
    }
    .scorebox .checkroast{
      display:flex;align-items:center;justify-content:center;gap:6px;
      font-size:11px;font-weight:700;color:#333;margin-top:4px;
    }

    .section{border-bottom:1px solid #bbb;padding:8px 10px}
    .rowhead{
      display:flex;justify-content:space-between;align-items:flex-end;gap:10px;
      font-weight:800;font-size:12px;letter-spacing:.2px;margin-bottom:4px;
    }
    .rowhead .rightlabel{
      font-weight:800;font-size:11px;color:#333;
      display:flex;gap:8px;align-items:center;
    }
    .sliderwrap{display:flex;gap:10px;align-items:center}
    .scale{flex:1;display:flex;flex-direction:column;gap:4px}

    input[type="range"]{
      width:100%;
      -webkit-appearance:none;appearance:none;
      height:18px;background:transparent;margin:0;
    }
    input[type="range"]::-webkit-slider-runnable-track{
      height:2px;background:var(--ink);border-radius:999px;
    }
    input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none;appearance:none;
      width:10px;height:10px;border-radius:50%;
      background:#fff;border:2px solid var(--ink);
      margin-top:-4px;
    }
    input[type="range"]::-moz-range-track{height:2px;background:var(--ink);border-radius:999px}
    input[type="range"]::-moz-range-thumb{
      width:10px;height:10px;border-radius:50%;
      background:#fff;border:2px solid var(--ink);
    }

    .ticks{display:flex;justify-content:space-between;align-items:center;font-size:10px;color:#222}
    .ticks span{min-width:16px;text-align:center}
    .microhint{
      font-size:9px;color:#444;font-weight:700;
      display:flex;justify-content:space-between;margin-top:2px;letter-spacing:.1px;
    }

    .notes{
      margin-top:6px;
      display:grid;
      grid-template-columns: 44px 1fr;
      gap:8px;
      align-items:start;
    }
    .notes label{font-size:11px;font-weight:800;color:#333}
    .notes textarea{
      width:100%;min-height:34px;resize:vertical;
      border:0;border-top:1px solid #888;
      outline:none;padding:6px 6px 0 6px;font-size:12px;
    }

    .helper{
      margin-top:6px;
      display:flex;flex-wrap:wrap;gap:6px;
      padding-left:52px;
    }
    .chip{
      border:1px solid #bbb;
      border-radius:999px;
      padding:3px 8px;
      font-size:11px;
      background:#fff;
      cursor:pointer;
      user-select:none;
    }
    .chip:hover{border-color:#666}

    .circles{display:flex;gap:6px;align-items:center}
    .circle{
      width:14px;height:14px;border-radius:50%;
      border:1.8px solid var(--ink);
      background:#fff;cursor:pointer;
    }
    .circle.on{background:var(--ink)}

    .bottomRow{
      padding:10px;
      display:grid;
      grid-template-columns: 1fr;
      gap:8px;
      margin-top:auto;
    }
    .bottomItem{border-top:1px solid #bbb;padding-top:8px}
    .bottomTitle{
      display:flex;justify-content:space-between;align-items:center;
      font-size:12px;font-weight:900;
    }
    .bigcircles .circle{width:16px;height:16px}

    /* ===== PRINT: force 3 columns per page + page breaks ===== */
    @media print{
      body{background:#fff}
      .page{box-shadow:none;border:0;width:auto;margin:0}
      .toolbar{display:none}

      .grid{
        display:block; /* we will print pages, not the screen grid */
      }
      .print-page{
        page-break-after: always;
        break-after: page;
      }
      .print-page:last-child{
        page-break-after: auto;
        break-after: auto;
      }
      .print-grid{
        display:grid;
        grid-template-columns: repeat(3, 1fr);
        gap:8px;
      }
      .sample{
        min-height:auto;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="toolbar">
      <button id="btnPrint" type="button">Print / Save as PDF</button>
      <button id="btnAddSample" type="button">+ Add Sample</button>
      <button id="btnRemoveSample" type="button">− Remove Last Sample</button>
      <div class="spacer"></div>
      <button id="btnReset" type="button">Reset</button>
    </div>

    <div class="header">
      <div class="header-left">
        <div class="linefield">
          <label for="name">NAME:</label>
          <input id="name" type="text" />
        </div>
        <div class="linefield">
          <label for="table">TABLE:</label>
          <input id="table" type="text" />
        </div>
      </div>
      <div class="brand">
        <div style="font-size:11px;">SCI</div>
        <b>SUSTAINABLE COFFEE INSTITUTE</b><br/>
        <span style="font-weight:800;">CUPPING FORM</span>
      </div>
    </div>

    <!-- Screen container -->
    <div class="grid" id="grid"></div>

    <!-- Print container (built dynamically before printing) -->
    <div id="printRoot" style="display:none;"></div>
  </div>

<script>
  const ATTRS = [
    { key:'fragrance',  label:'FRAGRANCE',  right:'INTENSITY', hintL:'LOW',  hintR:'HIGH' },
    { key:'aroma',      label:'AROMA',      right:'INTENSITY', hintL:'LOW',  hintR:'HIGH' },
    { key:'flavor',     label:'FLAVOR',     right:'INTENSITY', hintL:'LOW',  hintR:'HIGH' },
    { key:'acidity',    label:'ACIDITY',    right:'INTENSITY', hintL:'FLAT', hintR:'BRIGHT' },
    { key:'mouthfeel',  label:'MOUTHFEEL',  right:'THICKNESS', hintL:'THIN', hintR:'THICK' },
    { key:'sweetness',  label:'SWEETNESS',  right:'INTENSITY', hintL:'LOW',  hintR:'HIGH' },
    { key:'aftertaste', label:'AFTERTASTE', right:'DURATION',  hintL:'SHORT',hintR:'LONG' },
    { key:'freshcrop',  label:'FRESH CROP', right:'WOODY',     hintL:'NONE', hintR:'INTENSE' },
  ];

  const UNIFORMITY_BASE = 10;
  const DEFECT_BASE = 10;
  const DEDUCT_PER_CHECK = 2;

  const NOTE_HELPERS = {
    fragrance: ["Floral","Jasmine","Rose","Citrus","Bergamot","Chocolate","Cocoa","Caramel","Nutty","Almond","Hazelnut","Spice","Cinnamon","Clove","Earthy","Herbal"],
    aroma: ["Fruit-forward","Berry","Stone fruit","Tropical","Citrus zest","Sweet","Honey","Brown sugar","Molasses","Vanilla","Toasty","Roasty","Fermented","Alcoholic"],
    flavor: ["Clean","Complex","Balanced","Juicy","Bright","Sweet","Crisp","Layered","Chocolatey","Nutty","Spicy","Herbal","Winey","Tea-like"],
    acidity: ["Citric","Malic (apple)","Tartaric (grape)","Phosphoric (sparkling)","Lactic (creamy)","Bright","Crisp","Soft","Rounded","Flat","Sharp","Sour"],
    mouthfeel: ["Silky","Creamy","Velvety","Syrupy","Round","Smooth","Coating","Tea-like","Watery","Drying","Astringent","Oily"],
    sweetness: ["Honey","Caramel","Brown sugar","Maple","Cane sugar","Chocolate","High sweetness","Medium sweetness","Low sweetness"],
    aftertaste: ["Long","Short","Clean finish","Lingering sweet","Dry finish","Bitter finish","Cocoa finish","Spicy finish","Fruity finish"],
    freshcrop: ["No woody","Slight woody","Woody","Baggy","Papery","Stale","Flat/aged"],
    uniformityNotes: ["All cups consistent","Slight variation","One cup off","Temp issue","Grind inconsistency"],
    defectNotes: ["Phenolic","Rubbery","Potato defect","Moldy","Earthy/musty","Smoky/ashy","Sour-ferment","Dirty","Baggy","Stale","Over-roasted","Under-developed"]
  };

  function el(tag, attrs={}, children=[]){
    const n = document.createElement(tag);
    Object.entries(attrs).forEach(([k,v])=>{
      if(k==='class') n.className=v;
      else if(k==='html') n.innerHTML=v;
      else if(k.startsWith('on') && typeof v==='function') n.addEventListener(k.slice(2), v);
      else n.setAttribute(k,v);
    });
    children.forEach(c=> n.appendChild(c));
    return n;
  }

  function newSampleState(){
    const obj = {
      sampleNo:'',
      checkRoast:false,
      uniformity:[false,false,false,false,false],
      defect:[false,false,false,false,false],
      uniformityNotes:'',
      defectNotes:''
    };
    ATTRS.forEach(a=>{
      obj[a.key] = { score:6.0, intensity:0, notes:'' };
    });
    return obj;
  }

  let state = { name:'', table:'', samples:[newSampleState(), newSampleState(), newSampleState()] };

  function circleGroup(sampleIdx, attrKey, groupKey, count=5){
    const wrap = el('div',{class:'circles', 'data-group':`${sampleIdx}.${attrKey}.${groupKey}`});
    for(let i=1;i<=count;i++){
      const c = el('div',{class:'circle', role:'button', tabindex:'0', 'aria-label':`${groupKey} ${i}`});
      c.addEventListener('click', ()=> setCircle(sampleIdx, attrKey, groupKey, i));
      c.addEventListener('keydown', (e)=>{
        if(e.key==='Enter' || e.key===' '){ e.preventDefault(); setCircle(sampleIdx, attrKey, groupKey, i); }
      });
      wrap.appendChild(c);
    }
    return wrap;
  }

  function setCircle(sampleIdx, attrKey, groupKey, value){
    const sel = `[data-group="${sampleIdx}.${attrKey}.${groupKey}"] .circle`;
    const cs = document.querySelectorAll(sel);
    cs.forEach((c, idx)=> c.classList.toggle('on', idx < value));
    state.samples[sampleIdx][attrKey][groupKey] = value;
  }

  function insertChipText(textarea, text){
    const insert = (textarea.value && !textarea.value.trim().endsWith(",")) ? ", " : "";
    textarea.value = (textarea.value ? textarea.value : "") + insert + text;
    textarea.dispatchEvent(new Event('input', {bubbles:true}));
    textarea.focus();
  }

  function helperRow(helperKey, textarea){
    const phrases = NOTE_HELPERS[helperKey] || [];
    if(!phrases.length) return null;
    const wrap = el('div',{class:'helper'});
    phrases.forEach(p=>{
      const chip = el('div',{class:'chip', role:'button', tabindex:'0', 'aria-label':`add ${p}`});
      chip.textContent = p;
      chip.addEventListener('click', ()=> insertChipText(textarea, p));
      chip.addEventListener('keydown',(e)=>{
        if(e.key==='Enter'||e.key===' '){ e.preventDefault(); insertChipText(textarea, p); }
      });
      wrap.appendChild(chip);
    });
    return wrap;
  }

  function sliderRow(sampleIdx, attr){
    const row = el('div',{class:'section'});
    const head = el('div',{class:'rowhead'},[
      el('div',{html:attr.label}),
      el('div',{class:'rightlabel'},[
        el('span',{html:attr.right}),
        circleGroup(sampleIdx, attr.key, 'intensity', 5)
      ])
    ]);

    const range = el('input',{
      type:'range', min:'6.0', max:'10.0', step:'0.1',
      value:'6.0',
      'data-range': `${sampleIdx}.${attr.key}.score`
    });
    range.addEventListener('input', ()=>{
      state.samples[sampleIdx][attr.key].score = Number(range.value);
      updateTotals();
    });

    const ticks = el('div',{class:'ticks'},[
      el('span',{html:'6'}), el('span',{html:'7'}), el('span',{html:'8'}), el('span',{html:'9'}), el('span',{html:'10'})
    ]);

    const hint = el('div',{class:'microhint'},[
      el('span',{html:attr.hintL}),
      el('span',{html:attr.hintR})
    ]);

    const notesWrap = el('div',{class:'notes'},[
      el('label',{html:'NOTES:'}),
      el('textarea',{'data-notes':`${sampleIdx}.${attr.key}.notes`})
    ]);
    const textarea = notesWrap.querySelector('textarea');

    textarea.addEventListener('input', (e)=>{
      state.samples[sampleIdx][attr.key].notes = e.target.value;
    });

    row.appendChild(head);
    row.appendChild(el('div',{class:'sliderwrap'},[
      el('div',{class:'scale'},[range, ticks, hint])
    ]));
    row.appendChild(notesWrap);

    const helpers = helperRow(attr.key, textarea);
    if(helpers) row.appendChild(helpers);

    return row;
  }

  function renderBottomRow(sampleIdx, which){
    const cs = document.querySelectorAll(`[data-group="${sampleIdx}.${which}"] .circle`);
    cs.forEach((c, idx)=> c.classList.toggle('on', !!state.samples[sampleIdx][which][idx]));
  }

  function toggleBottomCircle(sampleIdx, which, idx){
    state.samples[sampleIdx][which][idx] = !state.samples[sampleIdx][which][idx];
    if(which === 'defect' && state.samples[sampleIdx].defect[idx] === true){
      state.samples[sampleIdx].uniformity[idx] = true;
    }
    renderBottomRow(sampleIdx, which);
    if(which === 'defect') renderBottomRow(sampleIdx, 'uniformity');
    updateTotals();
  }

  function buildBottomNotes(sampleIdx, which, helperKey, notesKey){
    const item = el('div',{class:'bottomItem'},[
      el('div',{class:'bottomTitle'},[
        el('div',{html: which === 'uniformity' ? 'UNIFORMITY' : 'DEFECT'}),
        el('div',{class:'circles bigcircles', 'data-group':`${sampleIdx}.${which}`})
      ]),
      el('div',{class:'notes'},[
        el('label',{html:'NOTES:'}),
        el('textarea',{'data-notes':`${sampleIdx}.${notesKey}`})
      ])
    ]);

    for(let i=1;i<=5;i++){
      const c = el('div',{class:'circle', role:'button', tabindex:'0', 'aria-label':`${which} ${i}`});
      c.addEventListener('click', ()=> toggleBottomCircle(sampleIdx, which, i-1));
      c.addEventListener('keydown',(e)=>{
        if(e.key==='Enter'||e.key===' '){ e.preventDefault(); toggleBottomCircle(sampleIdx, which, i-1); }
      });
      item.querySelector(`[data-group="${sampleIdx}.${which}"]`).appendChild(c);
    }

    const ta = item.querySelector('textarea');
    ta.addEventListener('input', (e)=> state.samples[sampleIdx][notesKey] = e.target.value);

    const helpers = helperRow(helperKey, ta);
    if(helpers) item.appendChild(helpers);

    return item;
  }

  function buildSample(sampleIdx){
    const sample = el('div',{class:'sample', 'data-sample':String(sampleIdx)});

    const sampleNo = el('div',{class:'sampleNo'},[
      el('div',{html:'SAMPLE #'}),
      el('input',{type:'text', 'data-samplefield':`${sampleIdx}.sampleNo`})
    ]);

    const scorebox = el('div',{class:'scorebox'},[
      el('div',{class:'lbl', html:'TOTAL SCORE'}),
      el('div',{class:'total', 'data-total':String(sampleIdx), html:'0.0'}),
      el('div',{class:'subtot', 'data-subtot':String(sampleIdx), html:''}),
      el('div',{class:'checkroast'},[
        el('span',{html:'CHECK ROAST'}),
        el('input',{type:'checkbox', 'data-samplefield':`${sampleIdx}.checkRoast`})
      ])
    ]);

    sample.appendChild(el('div',{class:'toprow'},[sampleNo, scorebox]));
    ATTRS.forEach(a => sample.appendChild(sliderRow(sampleIdx, a)));

    const bottom = el('div',{class:'bottomRow'});
    bottom.appendChild(buildBottomNotes(sampleIdx,'uniformity','uniformityNotes','uniformityNotes'));
    bottom.appendChild(buildBottomNotes(sampleIdx,'defect','defectNotes','defectNotes'));
    sample.appendChild(bottom);

    sample.querySelectorAll('[data-samplefield]').forEach(inp=>{
      inp.addEventListener('input', ()=>{
        const [s, field] = inp.getAttribute('data-samplefield').split('.');
        if(field === 'checkRoast') state.samples[Number(s)].checkRoast = inp.checked;
        else state.samples[Number(s)][field] = inp.value;
      });
      if(inp.type === 'checkbox'){
        inp.addEventListener('change', ()=>{
          const [s, field] = inp.getAttribute('data-samplefield').split('.');
          state.samples[Number(s)][field] = inp.checked;
        });
      }
    });

    return sample;
  }

  function countTrue(arr){ return arr.reduce((n,v)=> n + (v?1:0), 0); }

  function computeSampleTotals(sample){
    const attributesSum = ATTRS.reduce((sum,a)=> sum + Number(sample[a.key].score || 0), 0);
    const uniChecks = countTrue(sample.uniformity);
    const defChecks = countTrue(sample.defect);

    const uniformityScore = UNIFORMITY_BASE - (uniChecks * DEDUCT_PER_CHECK);
    const defectScore     = DEFECT_BASE     - (defChecks * DEDUCT_PER_CHECK);

    const total = attributesSum + uniformityScore + defectScore;
    return { attributesSum, uniChecks, defChecks, uniformityScore, defectScore, total };
  }

  function updateTotals(){
    for(let i=0;i<state.samples.length;i++){
      const t = computeSampleTotals(state.samples[i]);

      const totalEl = document.querySelector(`[data-total="${i}"]`);
      const subEl   = document.querySelector(`[data-subtot="${i}"]`);
      if(!totalEl || !subEl) continue;

      totalEl.textContent = t.total.toFixed(1);
      subEl.innerHTML =
        `Attr: ${t.attributesSum.toFixed(1)}<br>` +
        `Uniformity: ${t.uniformityScore.toFixed(1)} (10 - ${t.uniChecks}×2)<br>` +
        `Defect: ${t.defectScore.toFixed(1)} (10 - ${t.defChecks}×2)`;
    }
  }

  function applyStateToUI(){
    document.getElementById('name').value = state.name || '';
    document.getElementById('table').value = state.table || '';

    for(let s=0;s<state.samples.length;s++){
      const sampleEl = document.querySelector(`[data-sample="${s}"]`);
      if(!sampleEl) continue;

      sampleEl.querySelectorAll('[data-samplefield]').forEach(inp=>{
        const [si, field] = inp.getAttribute('data-samplefield').split('.');
        if(Number(si)!==s) return;
        if(inp.type==='checkbox') inp.checked = !!state.samples[s][field];
        else inp.value = state.samples[s][field] || '';
      });

      ATTRS.forEach(a=>{
        const r = document.querySelector(`[data-range="${s}.${a.key}.score"]`);
        if(r) r.value = state.samples[s][a.key].score ?? 6.0;

        const intensityVal = state.samples[s][a.key].intensity ?? 0;
        const cs = document.querySelectorAll(`[data-group="${s}.${a.key}.intensity"] .circle`);
        cs.forEach((c, idx)=> c.classList.toggle('on', idx < intensityVal));

        const t = document.querySelector(`[data-notes="${s}.${a.key}.notes"]`);
        if(t) t.value = state.samples[s][a.key].notes || '';
      });

      renderBottomRow(s,'uniformity');
      renderBottomRow(s,'defect');

      const un = document.querySelector(`[data-notes="${s}.uniformityNotes"]`);
      const dn = document.querySelector(`[data-notes="${s}.defectNotes"]`);
      if(un) un.value = state.samples[s].uniformityNotes || '';
      if(dn) dn.value = state.samples[s].defectNotes || '';
    }
    updateTotals();
  }

  function bindTopFields(){
    document.getElementById('name').addEventListener('input', (e)=> state.name = e.target.value);
    document.getElementById('table').addEventListener('input', (e)=> state.table = e.target.value);
  }

  function addSample(){
    const idx = state.samples.length;
    state.samples.push(newSampleState());
    document.getElementById('grid').appendChild(buildSample(idx));
    applyStateToUI();
  }

  function removeLastSample(){
    if(state.samples.length <= 1) return;
    const idx = state.samples.length - 1;
    const node = document.querySelector(`[data-sample="${idx}"]`);
    if(node) node.remove();
    state.samples.pop();
    updateTotals();
  }

  function resetAll(){
    state = { name:'', table:'', samples:[newSampleState(), newSampleState(), newSampleState()] };
    const grid = document.getElementById('grid');
    grid.innerHTML = '';
    for(let i=0;i<state.samples.length;i++) grid.appendChild(buildSample(i));
    applyStateToUI();
  }

  /* ===== Print paging: 3 samples per printed page ===== */
  function buildPrintPages(){
    const printRoot = document.getElementById('printRoot');
    const screenGrid = document.getElementById('grid');

    // wipe previous print layout
    printRoot.innerHTML = '';

    // clone samples in order
    const samples = Array.from(screenGrid.querySelectorAll('.sample'));

    for(let i=0;i<samples.length;i+=3){
      const page = document.createElement('div');
      page.className = 'print-page';

      // optional: add the same header per printed page (keeps PDFs readable)
      const headerClone = document.querySelector('.header').cloneNode(true);
      page.appendChild(headerClone);

      const grid = document.createElement('div');
      grid.className = 'print-grid';

      samples.slice(i, i+3).forEach(s => grid.appendChild(s.cloneNode(true)));
      page.appendChild(grid);

      printRoot.appendChild(page);
    }
  }

  function beforePrint(){
    buildPrintPages();

    // hide screen grid, show print pages
    document.getElementById('grid').style.display = 'none';
    document.getElementById('printRoot').style.display = 'block';
  }

  function afterPrint(){
    // restore
    document.getElementById('printRoot').style.display = 'none';
    document.getElementById('grid').style.display = 'grid';
    document.getElementById('printRoot').innerHTML = '';
  }

  window.addEventListener('beforeprint', beforePrint);
  window.addEventListener('afterprint', afterPrint);

  // Init
  const grid = document.getElementById('grid');
  for(let i=0;i<state.samples.length;i++) grid.appendChild(buildSample(i));
  bindTopFields();
  applyStateToUI();

  // Toolbar
  document.getElementById('btnPrint').addEventListener('click', ()=> window.print());
  document.getElementById('btnReset').addEventListener('click', resetAll);
  document.getElementById('btnAddSample').addEventListener('click', addSample);
  document.getElementById('btnRemoveSample').addEventListener('click', removeLastSample);
</script>
</body>
</html>